{% extends "base.html" %}
{% load static %}
{% block content %}

<section class="section">
  <!-- Tableau de bord -->
  <div class="dashboard-title " style="text-align: left;">
    Tableau de bord
  </div>

  <!-- Statistiques Résumées -->
  <div class="stats-container">
    <div class="stat-card total">
      <div class="stat-icon">
        <i class="fas fa-layer-group"></i>
      </div>
      <div class="stat-info">
        <h4>Total des Enseignements</h4>
        <p id="total-fiches">{{ nombre_enseignements }}</p>
      </div>
    </div>

    <div class="stat-card validated">
      <div class="stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-info">
        <h4>Enseignements Validées</h4>
        <p id="fiches-validees">{{ enseignements_validees }}</p>
      </div>
    </div>

    <div class="stat-card rejected">
      <div class="stat-icon">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-info">
        <h4>Enseignements Rejetées</h4>
        <p id="fiches-rejetees">{{ enseignements_rejetees }}</p>
      </div>
    </div>

    <div class="stat-card pending">
      <div class="stat-icon">
        <i class="fas fa-spinner"></i>
      </div>
      <div class="stat-info">
        <h7>En cours de traitement</h7>
        <p id="fiches-en-cours">{{ enseignements_en_cours }}</p>
      </div>
    </div>
  </div>

  <!-- Section des Graphiques -->
  <div class="row mt-4">
    <div class="col-lg-6 col-md-6">
      <div class="card">
        <div class="card-header pb-0">
          <h6 class="mb-1">Graphique en Barres</h6>
        </div>
        <div class="card-body">
          <canvas id="bar-chart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6 col-md-6">
      <div class="card">
        <div class="card-header pb-0">
          <h6 class="mb-1">Diagramme Circulaire</h6>
        </div>
        <div class="card-body">
          <canvas id="pie-chart"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

<footer class="main-footer">
  <div class="footer-left">
    Copyright UVBF &copy; 2024 <div class="bullet"></div> Design By <a href="#">Faris Rabo</a>
  </div>
</footer>

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Récupérer les données injectées dans les indicateurs
    const totalFiches = parseInt(document.getElementById("total-fiches").textContent);
    const fichesValidees = parseInt(document.getElementById("fiches-validees").textContent);
    const fichesRejetees = parseInt(document.getElementById("fiches-rejetees").textContent);
    const fichesEnCours = parseInt(document.getElementById("fiches-en-cours").textContent);

    // Calcul des pourcentages
    const valPercent = ((fichesValidees / totalFiches) * 100).toFixed(2);
    const rejPercent = ((fichesRejetees / totalFiches) * 100).toFixed(2);
    const pendingPercent = ((fichesEnCours / totalFiches) * 100).toFixed(2);

    // Mise à jour des Graphiques

    // Graphique en Cercle
    const pieCtx = document.getElementById("pie-chart").getContext("2d");
    new Chart(pieCtx, {
      type: "pie",
      data: {
        labels: ["Validées", "Rejetées", "En cours"],
        datasets: [
          {
            data: [valPercent, rejPercent, pendingPercent],
            backgroundColor: ["#45ddbe", "#ff5b77", "#ffbd5d"],
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom",
          },
        },
      },
    });

    // Graphique en Barres
    const barCtx = document.getElementById("bar-chart").getContext("2d");
    new Chart(barCtx, {
      type: "bar",
      data: {
        labels: ["Validées", "Rejetées", "En cours"],
        datasets: [
          {
            label: "Pourcentage des fiches",
            data: [valPercent, rejPercent, pendingPercent],
            backgroundColor: ["#45ddbe", "#ff5b77", "#ffbd5d"],
          },
        ],
      },
      options: {
        responsive: true,
        scales: {
          x: {
            beginAtZero: true,
          },
          y: {
            beginAtZero: true,
          },
        },
      },
    });
  });
</script>

<style>
  .dashboard-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    margin-top: 40px;
    margin-bottom: 20px;
    text-align: center;
  }

  .stats-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
  }

  .stat-card {
    flex: 1 1 calc(25% - 15px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
  }

  .stat-card:hover {
    transform: scale(1.05);
  }

  .stat-icon {
    font-size: 3rem;
    padding: 10px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stat-info h4 {
    font-size: 13px;
    margin: 0;
    color: #333;
    font-weight: bold;
  }

  .stat-info h7 {
    font-size: 0,5rem;
    margin: 0;
    color: #333;
    font-weight: bold;
  }

  .stat-info p {
    font-size: 1.2rem;
    font-weight: bold;
    margin: 5px 0 0;
  }

  .stat-card.total {
    background: #69aeff;
    color: #fff;
  }

  .stat-card.validated {
    background: #45ddbe;
    color: #fff;
  }

  .stat-card.rejected {
    background: #ff5b77;
    color: #fff;
  }

  .stat-card.pending {
    background: #ffbd5d;
    color: #fff;
  }

  .stat-card.total .stat-icon {
    background: #dbefff;
    color: #69aeff;
  }

  .stat-card.validated .stat-icon {
    background: #d7f6ef;
    color: #45ddbe;
  }

  .stat-card.rejected .stat-icon {
    background: #ffe6ec;
    color: #ff5b77;
  }

  .stat-card.pending .stat-icon {
    background: #ffeed8;
    color: #ffbd5d;
  }
</style>
{% endblock content %}
