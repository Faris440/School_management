{% extends "base.html" %}
{% load static %}
{% load formsetify %}
{% load icon %}
{% load richtext %}

{% block title %} {{ card_title }} {% endblock title %}

{% block stylesheet %}
<link href="{% static 'formset/css/bootstrap5-extra.css' %}" rel="stylesheet">
{% if form_collection %}
<link href="{% static 'formset/css/collections.css' %}" rel="stylesheet">
{{ form_collection.media.css }}
{% else %}
{{ form.media.css }}
{% endif %}
<script type="module" src="{% static 'formset/js/django-formset.js' %}" nonce="{{ request.csp_nonce }}"></script>
{% endblock stylesheet %}

{% block breadcrumb %}<div class="breadcrumb-container">
    <ul class="breadcrumb">
        <li><a href="{% url 'index-view' %}"><i class="fa fa-home"></i> Accueil</a></li>
        <li><a href="#">Liste</a></li>
        <li><a href="#">Détail</a></li>
        <li class="active">{{ object.name }}</li>
    </ul>
</div>
{% endblock breadcrumb %}

{% block content %}
<div class="card mb-5">
	<div class="card-header" style="flex-direction: row;">
		<h2 class="float-start">{{ card_title }}</h2>
        <h2 style="padding-left: 50%;">
            {% include 'components/back_button.html' %}
        </h2>
		{% if back_url %}
        <a href="{{ back_url }}">
            <button type="button" class="btn btn-md btn-outline-secondary float-end" 
                data-bs-toggle="popover" data-bs-content="Retour"
                data-bs-container="body" data-bs-placement="top">
                {% icon "corner-up-left" height=option_size width=option_size %} Retour
            </button>
        </a>
        {% endif %}
		{% block more-info %}{% endblock more-info %}
	</div>
	<div class="card-body">
		<div>
			<django-formset enctype="multipart/form-data" endpoint="{{request.path}}" csrf-token="{{csrf_token}}"
				withhold-feedback="errors warnings success">
				{% if form_collection %}
				{{form_collection}}
				{% else %}
				{% render_form form  %}
				{% endif %}
				<div class="offset-sm-3 my-5">
					{% include 'button.html' with label="Enregistrer" color="btn btn-outline-success " icon_name='"save"' process="spinner -> submit -> okay(2000) -> proceed !~ bummer(10000) -> scrollToError" %}
					{% if can_rerender %}
					{% include 'button.html' with label="Enregistrer et Continuer" color="btn btn-outline-primary" icon_name='"refresh-cw"' process="spinner -> submit -> okay(2000) -> proceed -> reload !~ bummer(10000)" %}
					{% endif %}
					<a href="{{ list_url }}">{% include 'button.html' with label="Annuler" color="btn btn-outline-warning" icon_name='"x"' process="spinner -> reset -> proceed({{request.META.HTTP_REFERER}})" %}</a>
                    <a href="#" class="btn btn-outline-primary ">
                        Prévisualiser
                    </a>
				</div>
			</django-formset>
		</div>
	</div>
</div>
{% endblock content %}

{% block javascript %}
{% if form_collection %}
{{ form_collection.media.js }}
{% else %}
{{ form.media.js }}
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Récupère les éléments du formulaire
    const userTypeField = document.getElementById("id_user_type");
    const teacherTypeField = document.getElementById("id_teacher_type");
    const gradeFieldWrapper = document.querySelector(".field-grade");
    const diplomeFieldWrapper = document.querySelector(".field-diplome");

    // Fonction pour afficher/masquer les champs grade et diplome
    function toggleTeacherFields() {
        const userType = userTypeField ? userTypeField.value : null;
        const teacherType = teacherTypeField ? teacherTypeField.value : null;

        if (userType === "teacher" && teacherType === "permanent") {
            gradeFieldWrapper.style.display = "block";
            diplomeFieldWrapper.style.display = "block";
        } else {
            gradeFieldWrapper.style.display = "none";
            diplomeFieldWrapper.style.display = "none";
        }
    }

    // Attache la fonction aux événements de changement
    if (userTypeField) {
        userTypeField.addEventListener("change", toggleTeacherFields);
    }
    if (teacherTypeField) {
        teacherTypeField.addEventListener("change", toggleTeacherFields);
    }

    // Exécute la fonction au chargement de la page
    toggleTeacherFields();
});
</script>
{% endblock javascript %}
